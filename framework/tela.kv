ScreenManager:
    MenuScreen:
        name: "menu"
    SignupScreen:
        name: "signup"
    LoginScreen:
        name: "login"
    OperationsScreen:
        name: "operations"


<MenuScreen@Screen>:
    name: "menu"
    BoxLayout:
        orientation: "vertical"
        spacing: 20
        padding: 50

        Label:
            text: "Bem-vindo a Personal Finance"
            font_size: 32

        Button:
            text: "Sign up"
            size_hint_y: None
            height: 50
            on_release:
                root.manager.current = "signup"

        Button:
            text: "Log in"
            size_hint_y: None
            height: 50
            on_release:
                root.manager.current = "login"


<SignupScreen@Screen>:
    ScrollView:
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 15
            size_hint_y: None
            height: self.minimum_height

            Label:
                text: "Cadastro"
                font_size: 28
                size_hint_y: None
                height: 50

            TextInput:
                id: nome
                hint_text: "Nome"
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_nome(self.text)

            TextInput:
                id: sobrenome
                hint_text: "Sobrenome"
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_sobrenome(self.text)

            TextInput:
                id: senha
                hint_text: "Senha"
                password: True
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_senha(self.text)

            TextInput:
                id: nascimento
                hint_text: "Data de nascimento (DD/MM/AAAA)"
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_nascimento(self.text)

            TextInput:
                id: telefone
                hint_text: "Telefone"
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_telefone(self.text)

            TextInput:
                id: contribuinte
                hint_text: "Contribuinte"
                multiline: False
                size_hint_y: None
                height: 40
                on_focus: if not self.focus: app.validar_contribuinte(self.text)

            TextInput:
                id: endereco
                hint_text: "Endereço"
                multiline: False
                size_hint_y: None
                height: 40

            TextInput:
                id: deposito
                hint_text: "Depósito inicial"
                multiline: False
                size_hint_y: None
                height: 40

            Button:
                text: "Cadastrar"
                size_hint_y: None
                height: 50
                on_release: app.criar_conta()

            Label:
                id: mensagem
                text: ""
                color: 1,0,0,1
                size_hint_y: None
                height: 30

            Button:
                text: "Voltar ao Menu"
                size_hint_y: None
                height: 50
                on_release: app.root.current = "menu"


<LoginScreen@Screen>:
    ScrollView:
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 15
            size_hint_y: None
            height: self.minimum_height

            Label:
                text: "Login"
                font_size: 28
                size_hint_y: None
                height: 50

            TextInput:
                id: nome_login
                hint_text: "Nome"
                multiline: False
                size_hint_y: None
                height: 40

            TextInput:
                id: senha_login
                hint_text: "Senha"
                password: True
                multiline: False
                size_hint_y: None
                height: 40

            Button:
                text: "Entrar"
                size_hint_y: None
                height: 50
                on_release: app.login(nome_login.text, senha_login.text)

            Label:
                id: mensagem_login
                text: ""
                color: 1,0,0,1
                size_hint_y: None
                height: 30

            Button:
                text: "Voltar ao Menu"
                size_hint_y: None
                height: 50
                on_release: app.root.current = "menu"


<OperationsScreen@Screen>:
    ScrollView:
        BoxLayout:
            orientation: "vertical"
            padding: dp(12)
            spacing: dp(12)
            size_hint_y: None
            height: self.minimum_height

            Label:
                text: "Personal Finance"
                font_size: "20sp"

            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                Label:
                    text: "Saldo:"
                    size_hint_x: None
                    width: dp(60)
                Label:
                    id: balance_value
                    text: "R$ 0,00"

            # Adicionar Transação
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                Spinner:
                    id: add_tipo
                    text: "deposito"
                    values: ["deposito","retirada"]
                    size_hint_x: None
                    width: dp(120)
                TextInput:
                    id: add_valor
                    hint_text: "Valor"
                    input_filter: "float"
                TextInput:
                    id: add_desc
                    hint_text: "Descrição"
                Button:
                    text: "Adicionar"
                    on_release:
                        app.ui_add_transacao(add_tipo.text, add_valor.text, add_desc.text)
                        add_valor.text = ""
                        add_desc.text = ""

            # Feedback de operações
            Label:
                id: ops_feedback
                text: ""
                color: 1,0,0,1
                size_hint_y: None
                height: dp(24)

            # Histórico
            Label:
                text: "Últimas transações"
                size_hint_y: None
                height: dp(24)

            RecycleView:
                id: history_rv
                viewclass: "HistoryItem"
                RecycleBoxLayout:
                    default_size: None, dp(56)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'

            # Editar / Excluir
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                TextInput:
                    id: edit_id
                    hint_text: "ID transação"
                    input_filter: "int"
                    size_hint_x: None
                    width: dp(120)
                Spinner:
                    id: edit_tipo
                    text: "deposito"
                    values: ["deposito","retirada"]
                    size_hint_x: None
                    width: dp(120)
                TextInput:
                    id: edit_valor
                    hint_text: "Novo valor"
                    input_filter: "float"
                TextInput:
                    id: edit_desc
                    hint_text: "Nova descrição"
                Button:
                    text: "Editar"
                    on_release:
                        app.ui_editar_transacao(edit_id.text, edit_tipo.text, edit_valor.text if edit_valor.text else None, edit_desc.text if edit_desc.text else None)
                        edit_valor.text = ""
                        edit_desc.text = ""
                Button:
                    text: "Excluir"
                    on_release:
                        app.ui_excluir_transacao(edit_id.text)
                        edit_id.text = ""

            # Perfil
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                TextInput:
                    id: perfil_nome
                    hint_text: "Nome"
                TextInput:
                    id: perfil_email
                    hint_text: "Email"
                Button:
                    text: "Carregar Perfil"
                    on_release: app.ui_carregar_perfil()
                Button:
                    text: "Atualizar Perfil"
                    on_release: app.ui_atualizar_perfil(perfil_nome.text, perfil_email.text)

            Label:
                id: perfil_feedback
                text: ""
                size_hint_y: None
                height: dp(20)

            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                Button:
                    text: "Atualizar Saldo/Histórico"
                    on_release:
                        app.ui_get_saldo()
                        app.ui_listar_transacoes()
                Button:
                    text: "Sair"
                    on_release:
                        app.current_user_id = 0
                        app.root.current = "login"

<HistoryItem@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: dp(40)

    Label:
        id: tipo
        text: root.tipo if hasattr(root, "tipo") else ""
        size_hint_x: 0.3

    Label:
        id: valor
        text: root.valor if hasattr(root, "valor") else ""
        size_hint_x: 0.3

    Label:
        id: descricao
        text: root.descricao if hasattr(root, "descricao") else ""
        size_hint_x: 0.4
